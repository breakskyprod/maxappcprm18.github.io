<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–¶–µ–Ω—Ç—Ä –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏</title>
    <!-- MAX Bridge -->
    <script src="https://st.max.ru/js/max-web-app.js"></script>
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* –¢–í–û–ô –†–û–î–ù–û–ô –î–ò–ó–ê–ô–ù */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');

        body {
            background: linear-gradient(145deg, #f8f0ff 0%, #ede4f5 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            padding: 16px;
            padding-bottom: 40px;
            transition: background 0.3s ease;
        }

        .app-container {
            max-width: 500px;
            width: 100%;
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 40px;
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 20px 40px rgba(120, 30, 180, 0.08),
                        0 4px 12px rgba(0, 0, 0, 0.02);
            padding: 28px 22px;
            transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
        }

        .main-screen, .form-screen {
            display: block;
        }

        .form-screen {
            display: none;
        }

        h1 {
            font-size: 26px;
            font-weight: 800;
            color: #1D1D1D;
            margin-bottom: 8px;
            line-height: 1.2;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h1 i {
            color: #781EB4;
            font-size: 28px;
            background: rgba(120, 30, 180, 0.1);
            padding: 12px;
            border-radius: 18px;
        }

        .org-sub {
            color: #1D1D1D;
            font-size: 15px;
            margin-bottom: 28px;
            border-bottom: 1px solid rgba(120, 30, 180, 0.15);
            padding-bottom: 20px;
            font-weight: 500;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .org-sub i {
            color: #781EB4;
            margin-top: 2px;
        }

        .address-link {
            color: inherit;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
            transition: opacity 0.2s;
        }

        .address-link:hover {
            opacity: 0.8;
        }

        .address-link i {
            font-size: 12px;
            opacity: 0.7;
            margin-left: 2px;
        }

        .menu-icons {
            display: flex;
            justify-content: space-around;
            margin: 20px 0 32px;
            gap: 8px;
            flex-wrap: wrap;
        }

        .menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1 1 120px;
            min-width: 100px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 16px 4px;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            cursor: pointer;
            text-align: center;
            box-shadow: 0 4px 12px rgba(120, 30, 180, 0.05);
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.9);
            border-color: #781EB4;
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(120, 30, 180, 0.15);
        }

        .menu-item:active {
            transform: scale(0.92);
        }

        .menu-item:active .menu-icon {
            animation: iconPop 0.8s ease;
        }

        .menu-icon {
            font-size: clamp(32px, 8vw, 48px);
            color: #781EB4;
            margin-bottom: 8px;
            background: rgba(120, 30, 180, 0.08);
            padding: clamp(8px, 2vw, 16px);
            border-radius: 20px;
            transition: all 0.2s ease;
            width: clamp(60px, 15vw, 80px);
            height: clamp(60px, 15vw, 80px);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-item:hover .menu-icon {
            background: rgba(120, 30, 180, 0.15);
            transform: scale(1.05);
        }

        .menu-label {
            font-weight: 700;
            font-size: clamp(12px, 3.5vw, 15px);
            color: #1D1D1D;
            line-height: 1.3;
            letter-spacing: -0.2px;
            max-width: 100%;
            word-break: break-word;
        }

        @keyframes iconPop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: #9a3ae0; }
            100% { transform: scale(1); }
        }

        .phone-block {
            background: rgba(120, 30, 180, 0.05);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 28px;
            padding: clamp(12px, 3vw, 20px);
            margin: 16px 0 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid rgba(120, 30, 180, 0.2);
            transition: all 0.3s ease;
            flex-wrap: wrap;
            gap: 8px;
        }

        .phone-label {
            font-size: clamp(14px, 4vw, 16px);
            color: #1D1D1D;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .phone-label i {
            font-size: clamp(18px, 5vw, 20px);
            color: #781EB4;
            background: rgba(255, 255, 255, 0.9);
            padding: clamp(8px, 2vw, 10px);
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(120, 30, 180, 0.1);
        }

        .call-link {
            text-decoration: none;
            display: inline-block;
        }

        .phone-number {
            font-size: clamp(15px, 4vw, 17px);
            font-weight: 700;
            color: #1D1D1D;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(4px);
            padding: clamp(8px, 2vw, 12px) clamp(12px, 3vw, 18px);
            border-radius: 40px;
            border: 1px solid rgba(120, 30, 180, 0.3);
            display: inline-block;
            transition: all 0.2s ease;
            letter-spacing: 0.3px;
            box-shadow: 0 4px 12px rgba(120, 30, 180, 0.1);
            white-space: nowrap;
        }

        .phone-number:hover {
            background: white;
            border-color: #781EB4;
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(120, 30, 180, 0.2);
        }

        .phone-number:active {
            animation: phoneShake 1.5s ease;
        }

        .phone-number i {
            margin-right: 6px;
            font-size: 16px;
            color: #781EB4;
        }

        @keyframes phoneShake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            50% { transform: translateX(4px); }
            75% { transform: translateX(-2px); }
            100% { transform: translateX(0); }
        }

        .form-section {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 32px;
            padding: 26px;
            margin-bottom: 16px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            transition: all 0.3s ease;
        }

        .form-group {
            margin-bottom: 22px;
        }

        label {
            display: block;
            font-size: 14px;
            font-weight: 700;
            color: #1D1D1D;
            margin-bottom: 10px;
            letter-spacing: -0.2px;
        }

        label i {
            margin-right: 8px;
            font-size: 15px;
            color: #781EB4;
        }

        input {
            width: 100%;
            padding: 18px 20px;
            border: 1.5px solid rgba(120, 30, 180, 0.15);
            border-radius: 24px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            transition: 0.2s;
            color: #1D1D1D;
            backdrop-filter: blur(4px);
        }

        input:focus {
            border-color: #781EB4;
            outline: none;
            background: white;
            box-shadow: 0 0 0 4px rgba(120, 30, 180, 0.1);
        }

        input::placeholder {
            color: rgba(29, 29, 29, 0.4);
            font-weight: 400;
        }

        .radio-group {
            display: flex;
            gap: 28px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .radio-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .radio-item label {
            margin-bottom: 0;
            font-weight: 600;
            color: #1D1D1D;
        }

        input[type="radio"] {
            accent-color: #781EB4;
            width: 20px;
            height: 20px;
            margin-right: 4px;
        }

        .policy-text {
            font-size: 13px;
            color: #1D1D1D;
            background: rgba(120, 30, 180, 0.04);
            backdrop-filter: blur(8px);
            padding: 18px 20px;
            border-radius: 24px;
            margin: 24px 0 20px;
            border-left: 4px solid #781EB4;
            line-height: 1.6;
            font-weight: 500;
        }

        .policy-text a {
            color: #781EB4;
            text-decoration: underline;
            text-decoration-thickness: 2px;
            text-underline-offset: 4px;
            font-weight: 700;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .policy-text a:hover {
            opacity: 0.8;
        }

        .policy-text i {
            color: #781EB4;
            margin-right: 8px;
        }

        .button {
            background: linear-gradient(145deg, #8c2ed0, #781EB4);
            color: white;
            border: none;
            border-radius: 32px;
            padding: 20px 24px;
            font-size: 18px;
            font-weight: 700;
            width: 100%;
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            margin-bottom: 16px;
            cursor: pointer;
            box-shadow: 0 12px 28px rgba(120, 30, 180, 0.3);
            letter-spacing: 0.5px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 18px 32px rgba(120, 30, 180, 0.4);
            background: linear-gradient(145deg, #9a3ae0, #8620c8);
        }

        .button:active {
            transform: scale(0.94);
            animation: buttonGlow 1.0s ease;
        }

        .button:active i {
            animation: iconFly 1.0s ease;
        }

        .button i {
            font-size: 20px;
            color: white;
        }

        @keyframes buttonGlow {
            0% { box-shadow: 0 12px 28px rgba(120, 30, 180, 0.3); }
            50% { box-shadow: 0 4px 40px rgba(120, 30, 180, 0.7); }
            100% { box-shadow: 0 12px 28px rgba(120, 30, 180, 0.3); }
        }

        @keyframes iconFly {
            0% { transform: translateX(0); }
            50% { transform: translateX(6px); }
            100% { transform: translateX(0); }
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(120, 30, 180, 0.2);
            border-radius: 40px;
            color: #1D1D1D;
            font-size: 16px;
            font-weight: 700;
            padding: 14px 24px;
            cursor: pointer;
            margin-bottom: 20px;
            transition: all 0.2s ease;
        }

        .back-button:hover {
            background: white;
            border-color: #781EB4;
            color: #781EB4;
        }

        .back-button:active {
            transform: scale(0.96);
        }

        .back-button:active i {
            animation: arrowLeft 0.3s ease;
        }

        .back-button i {
            font-size: 16px;
            color: #781EB4;
        }

        @keyframes arrowLeft {
            0% { transform: translateX(0); }
            50% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        .toast-message {
            background: linear-gradient(145deg, #8c2ed0, #781EB4);
            color: white;
            padding: 18px 28px;
            border-radius: 60px;
            font-size: 16px;
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 460px;
            text-align: center;
            opacity: 0;
            transition: opacity 0.2s;
            pointer-events: none;
            z-index: 1000;
            font-weight: 600;
            box-shadow: 0 16px 32px rgba(120, 30, 180, 0.3);
            line-height: 1.5;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            letter-spacing: 0.3px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .toast-message.show {
            opacity: 1;
        }

        .toast-message i {
            font-size: 18px;
            color: white;
        }

        .footer-note {
            font-size: 12px;
            color: #1D1D1D;
            text-align: center;
            margin-top: 28px;
            font-weight: 500;
            letter-spacing: 0.3px;
            backdrop-filter: blur(4px);
            padding: 8px;
            border-radius: 40px;
            opacity: 0.7;
        }

        @media screen and (max-width: 380px) {
            .app-container {
                padding: 20px 16px;
            }

            h1 {
                font-size: 22px;
                gap: 8px;
            }

            h1 i {
                font-size: 24px;
                padding: 10px;
            }

            .org-sub {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .menu-icons {
                gap: 4px;
            }
            
            .menu-item {
                min-width: 90px;
                padding: 12px 2px;
            }
            
            .menu-icon {
                font-size: 32px;
                width: 55px;
                height: 55px;
                padding: 10px;
            }
            
            .menu-label {
                font-size: 11px;
            }
            
            .phone-block {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .phone-label {
                font-size: 13px;
                white-space: normal;
                margin-bottom: 4px;
            }
            
            .phone-number {
                font-size: 14px;
                padding: 8px 12px;
                width: 100%;
                text-align: center;
            }
            
            .call-link {
                width: 100%;
            }

            .form-section {
                padding: 20px;
            }

            input {
                padding: 16px 18px;
            }

            .button {
                padding: 16px 20px;
                font-size: 16px;
            }
        }

        @media screen and (min-width: 381px) and (max-width: 450px) {
            .menu-icon {
                font-size: 38px;
                width: 65px;
                height: 65px;
            }
            
            .phone-number {
                font-size: 15px;
                padding: 8px 14px;
            }
        }

        body.dark-theme {
            background: linear-gradient(145deg, #1a0a24, #0f0a1a);
        }

        body.dark-theme .app-container {
            background: rgba(20, 10, 30, 0.7);
            border-color: rgba(120, 30, 180, 0.3);
        }

        body.dark-theme h1,
        body.dark-theme .org-sub,
        body.dark-theme .menu-label,
        body.dark-theme .phone-label,
        body.dark-theme .phone-number,
        body.dark-theme label,
        body.dark-theme .radio-item label,
        body.dark-theme .policy-text,
        body.dark-theme .back-button,
        body.dark-theme .footer-note {
            color: #ffffff;
        }

        body.dark-theme .address-link {
            color: #ffffff;
        }

        body.dark-theme input {
            background: rgba(30, 20, 40, 0.9);
            color: white;
            border-color: rgba(120, 30, 180, 0.3);
        }

        body.dark-theme input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        body.dark-theme .menu-item {
            background: rgba(30, 20, 40, 0.6);
            border-color: rgba(120, 30, 180, 0.3);
        }

        body.dark-theme .phone-number {
            background: rgba(30, 20, 40, 0.8);
            color: white;
        }
    </style>
</head>
<body>
    <div class="app-container" id="appContainer">
        <!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù -->
        <div id="mainScreen" class="main-screen">
            <h1>
                <i class="fas fa-shield-hal"></i>
                –ë–£ –£–† ¬´–¶–µ–Ω—Ç—Ä –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∏¬ª
            </h1>
            
            <!-- –ê–î–†–ï–° –° –ö–õ–ò–ö–ê–ë–ï–õ–¨–ù–û–ô –ö–ê–†–¢–û–ô -->
            <div class="org-sub">
                <i class="fas fa-map-marker-alt"></i>
                <a href="https://yandex.ru/maps/-/CPQtMK1x" 
                   onclick="if (window.WebApp) { window.WebApp.openLink('https://yandex.ru/maps/-/CPQtMK1x'); return false; } else { window.open('https://yandex.ru/maps/-/CPQtMK1x', '_blank'); return false; }"
                   class="address-link">
                    –£–†, –≥. –ò–∂–µ–≤—Å–∫, —É–ª. –°–æ—Ñ—å–∏ –ö–æ–≤–∞–ª–µ–≤—Å–∫–æ–π, 8–∞
                    <i class="fas fa-external-link-alt"></i>
                </a>
            </div>

            <!-- –ê–î–ê–ü–¢–ò–í–ù–´–ï –ò–ö–û–ù–ö–ò –ú–ï–ù–Æ -->
            <div class="menu-icons">
                <div class="menu-item" id="menuConsult">
                    <div class="menu-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <span class="menu-label">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è<br>–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</span>
                </div>
                
                <div class="menu-item" id="menuInvite">
                    <div class="menu-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <span class="menu-label">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å<br>–Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</span>
                </div>
                
                <div class="menu-item" id="menuECAS">
                    <div class="menu-icon">
                        <i class="fas fa-external-link-alt"></i>
                    </div>
                    <span class="menu-label">–ï–¶–ê–°</span>
                </div>
            </div>

            <!-- –¢–ï–õ–ï–§–û–ù–ù–´–ô –ë–õ–û–ö -->
            <div class="phone-block">
                <span class="phone-label">
                    <i class="fas fa-headset"></i>
                    –£—Ç–æ—á–Ω–∏—Ç—å –≤–æ–ø—Ä–æ—Å—ã:
                </span>
                <a href="tel:+73412930345" class="call-link">
                    <span class="phone-number" id="clickablePhone">
                        <i class="fas fa-phone-alt"></i>
                        +7 (3412) 93-03-45
                    </span>
                </a>
            </div>
            <div style="height: 8px;"></div>
        </div>

        <!-- –≠–ö–†–ê–ù –§–û–†–ú–´ -->
        <div id="formScreen" class="form-screen">
            <button class="back-button" id="backToMainBtn">
                <i class="fas fa-arrow-left"></i>
                –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </button>
            <div id="formContent"></div>
        </div>
    </div>

    <div id="toast" class="toast-message">
        <i class="fas fa-check-circle"></i>
        <span id="toastText"></span>
    </div>

    <script>
        (function() {
            'use strict';

            const WebApp = window.WebApp;
            
            // ==============================================
            // üìû –ú–ê–°–ö–ê –î–õ–Ø –¢–ï–õ–ï–§–û–ù–ê
            // ==============================================
            function phoneMask(input) {
                if (!input) return;
                
                input.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, ''); // –£–±–∏—Ä–∞–µ–º –≤—Å—ë –∫—Ä–æ–º–µ —Ü–∏—Ñ—Ä
                    
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–æ 11 —Ü–∏—Ñ—Ä (7 + 10 –Ω–æ–º–µ—Ä)
                    if (value.length > 11) {
                        value = value.substring(0, 11);
                    }
                    
                    // –ï—Å–ª–∏ –ø–µ—Ä–≤–∞—è —Ü–∏—Ñ—Ä–∞ 7 –∏–ª–∏ 8, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ 7
                    if (value.length > 0) {
                        if (value[0] === '8' || value[0] === '7') {
                            value = '7' + value.substring(1);
                        } else {
                            // –ï—Å–ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –Ω–µ —Å 7 –∏–ª–∏ 8, –¥–æ–±–∞–≤–ª—è–µ–º 7 –≤ –Ω–∞—á–∞–ª–æ
                            value = '7' + value;
                        }
                    }
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º: +7 (XXX) XXX-XX-XX
                    let formattedValue = '';
                    if (value.length > 0) {
                        formattedValue = '+7';
                        
                        if (value.length > 1) {
                            formattedValue += ' (' + value.substring(1, 4);
                        }
                        if (value.length >= 5) {
                            formattedValue += ') ' + value.substring(4, 7);
                        }
                        if (value.length >= 8) {
                            formattedValue += '-' + value.substring(7, 9);
                        }
                        if (value.length >= 10) {
                            formattedValue += '-' + value.substring(9, 11);
                        }
                    }
                    
                    e.target.value = formattedValue;
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º +7 –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ, –µ—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ
                input.addEventListener('focus', function(e) {
                    if (!e.target.value) {
                        e.target.value = '+7';
                    }
                });
            }

            // ==============================================
            // üöÄ –û–¢–ü–†–ê–í–ö–ê –í GOOGLE –¢–ê–ë–õ–ò–¶–´
            // ==============================================
            const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxJMxVvQ-nR2bR4b7cXIoipG0gPBc3M2MJrMv3StXV026UrPlWP7HiFgEKxPD8bbRzKeA/exec'; // ‚Üê –í–°–¢–ê–í–¨ –°–í–û–ô URL

            async function sendToGoogleSheets(data) {
                try {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª–µ –∏–∑ MAX
                    let sender = '–Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω';
                    if (WebApp && WebApp.initDataUnsafe && WebApp.initDataUnsafe.user) {
                        const user = WebApp.initDataUnsafe.user;
                        sender = [user.last_name, user.first_name].filter(Boolean).join(' ');
                    }

                    const dataToSend = {
                        ...data,
                        sender: sender,
                        timestamp: new Date().toLocaleString('ru-RU')
                    };

                    console.log('üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Google Sheets:', dataToSend);

                    const response = await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(dataToSend)
                    });

                    showToast('–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞—è–≤–∫—É! –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –í–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è!', 'success');
                    
                    if (WebApp && WebApp.HapticFeedback) {
                        WebApp.HapticFeedback.notificationOccurred('success');
                    }
                    
                    return true;

                } catch (error) {
                    console.error('‚ùå –û—à–∏–±–∫–∞:', error);
                    showToast('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');
                    
                    if (WebApp && WebApp.HapticFeedback) {
                        WebApp.HapticFeedback.notificationOccurred('error');
                    }
                    
                    return false;
                }
            }

            // ==============================================
            // –û–°–ù–û–í–ù–û–ô –ö–û–î
            // ==============================================
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
            if (!WebApp) {
                alert('‚ö†Ô∏è –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –Ω–µ –≤ MAX.');
            } else {
                // –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –¢–ï–ú–ê MAX
                function applyMaxTheme() {
                    const body = document.body;
                    const theme = WebApp.colorScheme || WebApp.theme || 'light';
                    
                    if (theme === 'dark' || theme === 'night' || theme === 'black') {
                        body.classList.add('dark-theme');
                    } else {
                        body.classList.remove('dark-theme');
                    }
                }

                applyMaxTheme();

                WebApp.onEvent('themeChanged', function() {
                    applyMaxTheme();
                });

                if (WebApp.onEvent) {
                    WebApp.onEvent('colorSchemeChanged', applyMaxTheme);
                }

                WebApp.ready();
                WebApp.enableClosingConfirmation();
                WebApp.BackButton.show();
                WebApp.BackButton.onClick(() => {
                    if (formScreen.style.display === 'block') {
                        showMainScreen();
                    } else {
                        WebApp.close();
                    }
                });
            }

            const mainScreen = document.getElementById('mainScreen');
            const formScreen = document.getElementById('formScreen');
            const formContent = document.getElementById('formContent');
            const backToMainBtn = document.getElementById('backToMainBtn');

            const POLICY_URL = 'https://disk.yandex.ru/d/KrLs5xKSHHgzmA';

            function showMainScreen() {
                mainScreen.style.display = 'block';
                formScreen.style.display = 'none';
                if (WebApp) {
                    WebApp.BackButton.show();
                }
            }

            function showFormScreen(formHtml) {
                mainScreen.style.display = 'none';
                formScreen.style.display = 'block';
                formContent.innerHTML = formHtml;
                window.scrollTo(0, 0);
                if (WebApp && WebApp.HapticFeedback) {
                    WebApp.HapticFeedback.impactOccurred('light');
                }
            }

            backToMainBtn.addEventListener('click', function() {
                showMainScreen();
            });

            // 1. –ö–û–ù–°–£–õ–¨–¢–ê–¶–ò–Ø
            document.getElementById('menuConsult').addEventListener('click', function() {
                const formHtml = `
                    <h1 style="font-size: clamp(22px, 6vw, 26px); margin-bottom: 16px; color: #1D1D1D; display: flex; align-items: center; gap: 12px;">
                        <i class="fas fa-comments" style="color: #781EB4; background: rgba(120,30,180,0.1); padding: clamp(10px, 3vw, 12px); border-radius: 16px; font-size: clamp(22px, 6vw, 26px);"></i>
                        –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è
                    </h1>
                    <div class="form-section">
                        <div class="form-group">
                            <label style="color: #1D1D1D;">
                                <i class="fas fa-user" style="color: #781EB4;"></i>
                                –§–∞–º–∏–ª–∏—è –∏ –∏–º—è
                            </label>
                            <input type="text" id="consultName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω" autocomplete="name">
                        </div>
                        <div class="form-group">
                            <label style="color: #1D1D1D;">
                                <i class="fas fa-phone" style="color: #781EB4;"></i>
                                –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                            </label>
                            <input type="tel" id="consultPhone" placeholder="+7 (___) ___-__-__" autocomplete="tel">
                        </div>
                        <div class="form-group">
                            <label style="color: #1D1D1D;">
                                <i class="fas fa-sync" style="color: #781EB4;"></i>
                                –¢–∏–ø –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
                            </label>
                            <div class="radio-group">
                                <div class="radio-item">
                                    <input type="radio" name="consultType" id="consultPrimary" value="–ü–µ—Ä–≤–∏—á–Ω–æ" checked>
                                    <label for="consultPrimary" style="color: #1D1D1D;">–ü–µ—Ä–≤–∏—á–Ω–æ</label>
                                </div>
                                <div class="radio-item">
                                    <input type="radio" name="consultType" id="consultRepeated" value="–ü–æ–≤—Ç–æ—Ä–Ω–æ">
                                    <label for="consultRepeated" style="color: #1D1D1D;">–ü–æ–≤—Ç–æ—Ä–Ω–æ</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="policy-text" style="color: #1D1D1D; border-left-color: #781EB4;">
                        <i class="fas fa-shield" style="color: #781EB4;"></i>
                        –ù–∞–∂–∏–º–∞—è –Ω–∞ –∫–Ω–æ–ø–∫—É, –≤—ã –¥–∞–µ—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ <a href="#" onclick="window.WebApp.openLink('${POLICY_URL}'); return false;">–æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a> –∏ —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å c <a href="#" onclick="window.WebApp.openLink('${POLICY_URL}'); return false;">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.
                    </div>
                    <button class="button" id="submitConsultBtn">
                        <i class="fas fa-check-circle"></i>
                        –ó–∞–ø–∏—Å–∞—Ç—å—Å—è
                    </button>
                `;
                showFormScreen(formHtml);

                // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å–∫—É –∫ –ø–æ–ª—é —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                phoneMask(document.getElementById('consultPhone'));

                document.getElementById('submitConsultBtn').addEventListener('click', function() {
                    const name = document.getElementById('consultName')?.value.trim();
                    const phone = document.getElementById('consultPhone')?.value.trim();
                    
                    if (!name) {
                        showToast('–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é –∏ –∏–º—è', 'warning');
                        return;
                    }
                    if (!phone || phone === '+7') {
                        showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'warning');
                        return;
                    }

                    const consultType = document.querySelector('input[name="consultType"]:checked')?.value || '–ü–µ—Ä–≤–∏—á–Ω–æ';

                    const applicationData = {
                        type: 'consultation',
                        fullName: name,
                        phone: phone,
                        consultType: consultType
                    };

                    sendToGoogleSheets(applicationData);

                    setTimeout(() => {
                        showMainScreen();
                    }, 2000);
                });
            });

            // 2. –ü–†–ò–ì–õ–ê–®–ï–ù–ò–ï
            document.getElementById('menuInvite').addEventListener('click', function() {
                const formHtml = `
                    <h1 style="font-size: clamp(22px, 6vw, 26px); margin-bottom: 16px; color: #1D1D1D; display: flex; align-items: center; gap: 12px;">
                        <i class="fas fa-calendar-alt" style="color: #781EB4; background: rgba(120,30,180,0.1); padding: clamp(10px, 3vw, 12px); border-radius: 16px; font-size: clamp(22px, 6vw, 26px);"></i>
                        –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                    </h1>
                    <div class="form-section">
                        <div class="form-group">
                            <label style="color: #1D1D1D;">
                                <i class="fas fa-user-tie" style="color: #781EB4;"></i>
                                –§–ò–û
                            </label>
                            <input type="text" id="inviteFullName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                        </div>
                        <div class="form-group">
                            <label style="color: #1D1D1D;">
                                <i class="fas fa-briefcase" style="color: #781EB4;"></i>
                                –î–æ–ª–∂–Ω–æ—Å—Ç—å
                            </label>
                            <input type="text" id="invitePosition" placeholder="–î–∏—Ä–µ–∫—Ç–æ—Ä, —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç...">
                        </div>
                        <div class="form-group">
                            <label style="color: #1D1D1D;">
                                <i class="fas fa-phone" style="color: #781EB4;"></i>
                                –ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                            </label>
                            <input type="tel" id="invitePhone" placeholder="+7 (___) ___-__-__">
                        </div>
                        <div class="form-group">
                            <label style="color: #1D1D1D;">
                                <i class="fas fa-city" style="color: #781EB4;"></i>
                                –ú—É–Ω–∏—Ü–∏–ø–∞–ª—å–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
                            </label>
                            <input type="text" id="inviteMunicipality" placeholder="–≥. –ò–∂–µ–≤—Å–∫, –ó–∞–≤—å—è–ª–æ–≤—Å–∫–∏–π —Ä-–Ω...">
                        </div>
                        <div class="form-group">
                            <label style="color: #1D1D1D;">
                                <i class="fas fa-building" style="color: #781EB4;"></i>
                                –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
                            </label>
                            <input type="text" id="inviteOrg" placeholder="–û–û–û –ü—Ä–∏–º–µ—Ä, –®–∫–æ–ª–∞ ‚Ññ1...">
                        </div>
                    </div>
                    <div class="policy-text" style="color: #1D1D1D; border-left-color: #781EB4;">
                        <i class="fas fa-shield" style="color: #781EB4;"></i>
                        –ù–∞–∂–∏–º–∞—è –Ω–∞ –∫–Ω–æ–ø–∫—É, –≤—ã –¥–∞–µ—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ <a href="#" onclick="window.WebApp.openLink('${POLICY_URL}'); return false;">–æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a> –∏ —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å c <a href="#" onclick="window.WebApp.openLink('${POLICY_URL}'); return false;">–ø–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.
                    </div>
                    <button class="button" id="submitInviteBtn">
                        <i class="fas fa-paper-plane"></i>
                        –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ
                    </button>
                `;
                showFormScreen(formHtml);

                // –ü—Ä–∏–º–µ–Ω—è–µ–º –º–∞—Å–∫—É –∫ –ø–æ–ª—é —Ç–µ–ª–µ—Ñ–æ–Ω–∞
                phoneMask(document.getElementById('invitePhone'));

                document.getElementById('submitInviteBtn').addEventListener('click', function() {
                    const fullName = document.getElementById('inviteFullName')?.value.trim();
                    const position = document.getElementById('invitePosition')?.value.trim();
                    const phone = document.getElementById('invitePhone')?.value.trim();
                    const municipality = document.getElementById('inviteMunicipality')?.value.trim();
                    const org = document.getElementById('inviteOrg')?.value.trim();

                    if (!fullName || !position || !phone || !municipality || !org) {
                        showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', 'warning');
                        return;
                    }
                    
                    if (phone === '+7') {
                        showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞', 'warning');
                        return;
                    }

                    const inviteData = {
                        type: 'event_invite',
                        fullName,
                        position,
                        phone,
                        municipality,
                        organization: org
                    };

                    sendToGoogleSheets(inviteData);

                    setTimeout(() => {
                        showMainScreen();
                    }, 2000);
                });
            });

            // 3. –ï–¶–ê–°
            document.getElementById('menuECAS').addEventListener('click', function() {
                if (WebApp && WebApp.openLink) {
                    WebApp.openLink('https://vk.com/cprm18');
                } else {
                    window.open('https://vk.com/cprm18', '_blank');
                }
                
                if (WebApp && WebApp.HapticFeedback) {
                    WebApp.HapticFeedback.impactOccurred('soft');
                }
            });

            // TOAST
            function showToast(message, type = 'info') {
                const toast = document.getElementById('toast');
                const toastText = document.getElementById('toastText');
                toastText.innerText = message;
                toast.classList.add('show');
                
                let icon = 'fa-info-circle';
                if (type === 'success') icon = 'fa-check-circle';
                else if (type === 'warning') icon = 'fa-exclamation-triangle';
                else if (type === 'error') icon = 'fa-times-circle';
                
                toast.innerHTML = `<i class="fas ${icon}"></i><span id="toastText">${message}</span>`;
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 2000);
            }

            function initUserData() {
                const user = WebApp?.initDataUnsafe?.user;
                if (user) {
                    console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å MAX:', user);
                }
            }

            showMainScreen();
            initUserData();

        })();
    </script>
</body>
</html>
